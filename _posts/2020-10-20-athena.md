---
layout: post
title: "ATHENA"
subtitle: "A Framework based on Diverse Weak Defenses for Building Adversarial Defense"
author: Ying Meng*, Jianhai Su, Jason M O'Kane, and Pooyan Jamshidi
---

|[![arXiv preprint](./images/athena_preprint.png "arXiv preprint"){:height="130px" width="110px" border="1px solid blue"}](https://arxiv.org/abs/2001.00308 "arXiv preprint")|[![code](./images/athena_code.png "code on GitHub"){:height="130px" width="110px" border="1px solid blue"}](https://github.com/softsys4ai/athena "code on GitHub")|[![class project](./images/class_project.png "class project"){:height="130px" width="110px" border="1px solid blue"}](https://github.com/csce585-mlsystems/project-athena "class project")|[![tutorial](./images/tutorial_craftAE_zk.png "Generate zero knowledge AEs tutorial"){:height="130px" width="110px" border="1px solid blue"}](https://github.com/csce585-mlsystems/project-athena/blob/master/notebooks/Task1_GenerateAEs_ZeroKnowledgeModel.ipynb "Generate zero knowledge AEs tutorial")|
|[arXiv <br> Preprint](https://arxiv.org/abs/2001.00308)|[Code <br> on GitHub](https://github.com/softsys4ai/athena)|[ATHENA as <br> class project](https://github.com/csce585-mlsystems/project-athena)|[tutorial: <br> generate AEs <br> in ZK model](https://github.com/csce585-mlsystems/project-athena/blob/master/notebooks/Task1_GenerateAEs_ZeroKnowledgeModel.ipynb){:font-size="xx-small"}|


--------
## Defense as a framework
Though deep learning systems have achieved impressive success in a wide range of domains like computer vision and natural language processing, they are highly vulnerable to adversarial examples. An adversarial example is an input artifact that is crafted from legitimate data by adding small and human-imperceptible perturbations, aiming to covertly force the deep learning system to produce an incorrect output. The vulnerability to adversarial examples can lead to a series of consequences, especially in security-critical tasks. For example, an object detector on a self-driving vehicle may incorrectly recognize an adversarial perturbed stop sign as a speed limit. 

In traditional machine learning, the test set is assumed to be drawn from an identical distribution of the training set. However, in adversarial machine learning, the defenders face an open-ended problem, in which an input can be an independent-identical-distribution (i.i.d.) sample (i.e., a legitimate sample) or an out-of-distribution (o.o.d.) sample (i.e., an adversarial example). Thus, research on adversarial defense is difficult. The threat of the adversarial examples has inspired a sizable body of research on various defense techniques. With the assumption on the specific known attack(s), most of the existing defenses, although effective against particular attacks, can be circumvented under slightly different conditions, either a stronger adaptive adversary or in some cases even weak (but different) adversaries. The "arms race" between the attacks and defenses leads us to this central question:

**`How can we, instead, design a defense, not as a technique, but as a framework that one can construct a specific defense considering the niche tradeoff space of robustness one may want to achieve as well as the cost one is willing to pay to achieve that level of robustness?`**

To address the question, we propose **ATHENA** --- a framework for building an ensemble defense on top of a large population of *diverse* transformations. In this framework, each WD is an image classifier that was independently trained on a transformed dataset at the training phase. At the test phase, a WD first applies a transformation *`t`* on the original input **`x`** and then produces an output for the transformed input *`t`*`(`**`x`**`)`. Given an input **`x`**, an ensemble (i) first collects outputs from all WDs, and then (ii) uses an *ensemble strategy* such as majority voting and averaging outputs from WDs to compute the final output.

![ATHENA framework](images/athena_fwk_test.png){:width="480px" height=auto}

--------
## Ensemble based on diverse transformations

In computer vision, a transformation is an image processing function. By distorbing its input, a transformation changes the adversarial optimized perturbations and thus making the perturbations less effective. However, the effectiveness of a single type of transformation varies on attacks and datasets. By mitigating the perturbations in different ways such as adjusting angles or position of the input, adding or removing noises, a collection of diverse transformations provides robustness against various attacks. Thus, the "Diverse" ensemble achieves the lowest error rate in most cases, especially for tasks on CIFAR-100. 

Ensembling diverse transformations can result in a robust defense against a variety of attacks and provide a *tradeoff space*, where one build a *higher robustness* ensemble by adding more transformation or build an ensemble with *lower overhead and cost* by utilizing fewer transformations.

![transformations as WDs](images/trans_as_wd.png){:width="340px" height=auto} ![motivation](images/athena_motivation.png){:width="480px" height="auto"}


--------
## Results

### Zero knowledge threat model

The effectiveness of individual WDs (each associated to a transformation) varies across attack methods and magnitudes of an attack. While a large population of transformations from a variety of categories successfully disentangle adversarial perturbations generated by various attacks. The variation of individual WDs' error rates spans wider as the perturbation magnitude become stronger for a selected attack. By utilizing many diverse transformations, with ATHENA, we build effective ensembles that outperform the two state-of-the-art defenses --- PGD adversarial training (PGD-ADT) and randomly smoothing (RS), in all cases.

![evaluations in the zero-knowledge context](images/eval_zk.png){:width="1000px" height=auto} 


### Black-box threat model

#### Transfer-based approach

Although the transferability rate increases as the budget increases, the increasing of the drop in the transferability rate from the undefended model (UM) to ATHENA indicates that ATHENA is less sensitive to the perturbation. Ensembling from many diverse transformations provides tangible benefits in blocking the adversarial transferability between weak defenses, and thus enhances model's robustness against the transfer-based black-box attack. 

![evaluations against transfer-based black-box attack](images/eval_bb_trans.png){:width="680px" height=auto} 


#### Gradient-direction-estimation-based approach

Hop-Skip-Jump attack (HSJA) generates adversarial examples by querying the output labels from the target model for the perturbed images. Compared to that generated based on the UM, the adversarial examples generated based on ATHENA are much further to the corresponding benign samples. As the query budget increases, the distances of the UM-targeted AEs drop much more significantly that that of the ATHENA-targeted AEs. Therefore, ATHENA provides robustness against HSJA with varying query budgets.

![evaluations against hsja attack](images/eval_bb_hsja.png){:width="480px" height=auto} ![hsja samples](images/samples_cifar100_bb_linf.png){:width="320px" height="auto"}

### Gray-box and white-box threat model

#### Greedy approach

As expected, stronger AEs are generated by the greedy white-box attack with a looser constraint on the dissimilarity threshold. However, such success comes at a price: with the largest threshold we examined (the maximal dissimilarity is $1.0$), the greedy attack has to spend $310x$ in time to generate adversarial example for a single input. This provides a tradeoff space, where realizations of ATHENA that employ larger ensembles incur more expensive defense to attack. Moreover, the generated AEs are distored heavily and very likely to be detected either by a human or an adversarial detector.

![evaluations against greedy white-box attack](images/eval_wb_greedy.png){:width="400px" height=auto} ![greedy adversarial examples](images/samples_cifar100_wb.png){:width="380px" height="auto"}

![computational cost of greedy white-box attack](images/eval_wb_cost.png){:width="380px" height=auto} ![detector](images/eval_wb_detector.png){:width="400px" height="auto"}


#### Optimization-based approach

As the adversary become more knowledgable to ATHENA (i.e., having access to more WDs), it can launch more successful attack without even increasing the perturbations. However, the computational cost of AE generation increases as well. The attacker has the choice to sample more random transformations and a choice to a distribution of a large population and diverse transformations, in order to generate stronger AEs. However, this will incur a larger computational cost as well.

![evaluations against optimization-based white-box attack](images/eval_wb_optimization.png){:width="460px" height=auto}

--------
## Acknowledgement
* ![google cloud](images/google_cloud.png){:width="25px" height="auto"} Google via GCP cloud research credits
* ![google cloud](images/nasa_logo.jpg){:width="25px" height="auto"} NASA (EPSCoR 521340-SC001)
* ![google cloud](images/usc_logo.png){:width="25px" height="auto"} Research Computing Center at University of South Carolina


--------
## How to cite

### Citation
```
Ying Meng, Jianhai Su, Jason M O'Kane, and Pooyan Jamshidi. *ATHENA: A Framework based on Diverse Weak Defenses for Building Adversarial Defense*. arXiv preprint arXiv: 2001.00308, 2020.
```

### Bibtex
```
@article{meng2020athena,
      title={ATHENA: A Framework based on Diverse Weak Defenses for Building Adversarial Defense},
      author={Ying Meng and Jianhai Su and Jason M O'Kane and Pooyan Jamshidi},
      journal={arXiv preprint arXiv:2001.00308},
      year={2020}
}
```


--------
## Talks
<iframe src="//www.slideshare.net/slideshow/embed_code/key/Cb31RI6bvqz2YE" width="480px" height="300px" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>

<div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/pooyanjamshidi/ensembles-of-many-diverse-weak-defenses-can-be-strong-defending-deep-neural-networks-against-adversarial-attacks" title="Ensembles of Many Diverse Weak Defenses can be Strong: Defending Deep Neural Networks Against Adversarial Attacks" target="_blank">Ensembles of Many Diverse Weak Defenses can be Strong: Defending Deep Neural Networks Against Adversarial Attacks</a> </strong> from <strong><a href="https://www.slideshare.net/pooyanjamshidi" target="_blank">Pooyan Jamshidi</a></strong> </div>

<script async class="speakerdeck-embed" data-id="5e56d27c80a94fb59cd019305eabf53f" data-ratio="1.8" style="width: 480px; height: auto;" src="//speakerdeck.com/assets/embed.js"></script>

--------
## Data availability

The [code posted on github](https://github.com/softsys4ai/athena) contains the analysis needed to reproduce the results in the paper. It also includes scripts for setting up all the dependencies using conda, and scripts to download the datasets and models used in the analysis of the paper. The models and datasets can also be downloaded directly (in keras, pickle, and pytorch formats) here:
* [CNN models for MNIST dataset](https://zenodo.org/record/4121901#.X5MPOnVKhhE)
* [SVM mdoels for MNIST dataset] *To be upload*
* Wide ResNet models and ResNet with Shake-Shake regularization models for CIFAR-100 dataset  *To be upload*
* AEs in the zero-knowledge model *To be upload*
* AEs in the black-box model *To be upload*
* AEs in the white-box model *To be upload*